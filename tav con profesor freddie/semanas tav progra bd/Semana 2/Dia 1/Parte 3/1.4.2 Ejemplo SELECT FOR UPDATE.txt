--AGREGAR FOTO AL EMPLEADO
CREATE OR REPLACE DIRECTORY OBJETOS_LOB AS 'D:\IMAGENES\';

--
GRANT READ, WRITE ON DIRECTORY OBJETOS_LOB TO GUIA6;

CREATE TABLE EMPLEADOS(
ID NUMBER(3) PRIMARY KEY,
NOMBRE VARCHAR2(20),
ESPECIALIDAD VARCHAR2(20)
);

INSERT INTO EMPLEADOS VALUES (1, 'ALBERTO', 'NO ESPECIFICADO', EMPTY_BLOB());
INSERT INTO EMPLEADOS VALUES (2, 'ANDREA', 'NO ESPECIFICADO', EMPTY_BLOB());
INSERT INTO EMPLEADOS VALUES (3, 'JUAN', 'NO ESPECIFICADO', EMPTY_BLOB());

ALTER TABLE EMPLEADOS ADD FOTO BLOB DEFAULT EMPTY_BLOB();


DECLARE
 V_MIN NUMBER(2):=0;
 V_MAX NUMBER(2):=0;
 
 V_TEMP_BLOB BLOB;
 V_BFILE     BFILE;
 V_FOTO VARCHAR2(20);
 
BEGIN
   
  SELECT MIN(ID) INTO V_MIN FROM EMPLEADOS;
  SELECT MAX(ID) INTO V_MAX FROM EMPLEADOS;

  FOR I IN V_MIN..V_MAX LOOP

    --SELECT DE ACTUALIZACIÓN, QUE SOLO ACTUALIZA LA FOTO

    SELECT FOTO into V_TEMP_BLOB    --RESCATO LO QUE ESTÁ EN FOTO PARA SER ACTUALIZADO
    FROM EMPLEADOS 			
    WHERE ID = I 
    FOR UPDATE;

    V_FOTO := I||'.JPG'; 

    V_BFILE:= BFILENAME('OBJETOS_LOB',V_FOTO);
    dbms_lob.open(V_BFILE, dbms_lob.lob_readonly);
    dbms_lob.loadfromfile(V_TEMP_BLOB, V_BFILE,dbms_lob.getlength(V_BFILE));
    DBMS_LOB.CLOSE(V_BFILE);
    COMMIT;
  END LOOP;
END;
